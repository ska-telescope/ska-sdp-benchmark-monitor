#!/usr/bin/bash

benchmon_pid_file=./.benchmon-run_pid_${OAR_JOB_ID}${SLURM_JOB_ID}_$(hostname)
if [[ -f ${benchmon_pid_file} ]]
then
    pid=$(cat ${benchmon_pid_file})
    pgid=$(ps -o pgid= -p "$pid" | tr -d ' ')
    ps -eo pid,pgid,comm | awk -v pgid="$pgid" -v name="rt-monitor" '$2 == pgid && $3 == name { print $1 }' | xargs -r kill -USR2
    ps -eo pid,pgid,comm | awk -v pgid="$pgid" -v regex="\\.sh$" '$2 == pgid && $3 ~ regex { print $1 }' | xargs -r kill -CONT
fi
