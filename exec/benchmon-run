#!/usr/bin/env python3
"""Main script to monitor system resources"""

import os

from benchmon.run import RunMonitor
from benchmon.run import RunUtils

HOSTNAME = os.uname()[1]


def main() -> None:
    """
    Run main function of benchmon-run
    """
    args = RunUtils.parse_args()

    os.makedirs(args.save_dir, exist_ok=True)
    logger = RunUtils.create_logger(save_dir=args.save_dir, verbose=args.verbose)

    logger.info("benchmon-run starts")

    args_str = ""
    for key, value in vars(args).items():
        args_str += f"\t--{key.replace('_', '-')} {value}\n"
    logger.debug(f"benchmon-run arguments: \n{args_str}")

    RunUtils.get_benchmon_pid(logger)
    runmonitor = RunMonitor(args, logger)
    runmonitor.run(timeout=args.test_timeout)

    logger.info("benchmon-run stops")
    logger.info(f"Traces saved in: {os.path.realpath(args.save_dir)}/benchmon_traces_{HOSTNAME}")
    logger.info(f"Full log file: {os.path.realpath(args.save_dir)}/benchmon_{HOSTNAME}.log")


if __name__ == "__main__":
    main()
