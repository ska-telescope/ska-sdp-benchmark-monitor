#!/usr/bin/env python3
"""
Main Python script to generate a report from monitoring metrics
"""

import argparse
import os
import shutil

from benchmon.report import report_generator


def parsing():
    """
    Parse arguments

    Returns:
        argparse.Namespace: Arguments namespace storing attributes
    """
    parser = argparse.ArgumentParser()

    parser.add_argument("--software-report",
                        type=str,
                        required=False,
                        help="Path to the software report from benchmon-software")

    parser.add_argument("--hardware-report",
                        type=str,
                        required=False,
                        help="Path to the software report from benchmon-hardware")

    parser.add_argument("--ps-report",
                        type=str,
                        required=False,
                        help="Path to the ps report from benchmon-run")

    parser.add_argument("--figure-path",
                        type=str,
                        required=False,
                        help="Path to the figure generated by benchmon-visu")

    parser.add_argument("--output",
                        type=str,
                        required=True,
                        help="Output file path")

    parent_dir = os.path.dirname(os.path.dirname(os.path.realpath(__file__)))
    parser.add_argument("--template",
                        type=str,
                        default=f"{parent_dir}/benchmon/report/template.md",
                        help="Path to the report Markdown template")

    return parser.parse_args()


def main():
    """Run main"""
    args = parsing()

    sw_report_path = args.software_report
    hw_report_path = args.hardware_report
    ps_report_path = args.ps_report
    figure_path = args.figure_path
    template_path = args.template
    output_path = args.output

    output_dir = os.path.dirname(output_path)
    if output_dir == "":
        output_dir = "./"
    figure_filename = os.path.basename(figure_path)
    destination_path = os.path.join(output_dir, figure_filename)
    shutil.copy(figure_path, destination_path)
    rg = report_generator.ReportGenerator(template_file_path=template_path)

    rg.write(hw_report_path, sw_report_path, ps_report_path, figure_filename, output_path)

    return 0


if __name__ == "__main__":
    main()
